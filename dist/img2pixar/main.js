var me=(e,t)=>()=>(e&&(t=e(e=0)),t);var we={};function Y(){let e=localStorage.getItem(I);if(e){try{e=JSON.parse(e)}catch{}for(let n in e){let o=document.querySelector(n+(n.includes('type="radio"')?`[value="${e[n]}"]`:""));if(!o){delete e[n];continue}o.type=="checkbox"||o.type=="radio"?o.checked=!!e[n]:o.value=e[n],o.dispatchEvent(new Event(o.tagName=="TEXTAREA"?"input":"change"))}localStorage.setItem(I,JSON.stringify(e))}document.querySelectorAll("[data-save]").forEach(n=>{n.addEventListener(n.tagName=="TEXTAREA"?"input":"change",()=>{let o=ve(n),s=localStorage.getItem(I)??"{}";try{s=JSON.parse(s)}catch{s={}}s[o]=n.value,n.type=="checkbox"?s[o]=n.checked:s[o]=n.value,localStorage.setItem(I,JSON.stringify(s))})})}function ve(e){let t=[];for(;e&&e.tagName!="BODY";){let n;if(e.id!=""){n="#"+e.id,t.unshift(n);break}else if(e.type=="radio"&&e.name){n=`#${e.dataset.save} ${e.tagName.toLowerCase()}[type="${e.type}"][name="${e.name}"]`,t.unshift(n);break}else n=`:nth-child(${Array.from(e.parentNode.children).indexOf(e)+1})`,t.unshift(n);e=e.parentNode}return t.join(">")}var I,W=me(()=>{I="dsatools_inputs-"+globalThis.toolPath.split("/").pop();document.readyState!="loading"?Y():document.addEventListener("DOMContentLoaded",Y)});import be from"/lib/pica.js";import xe from"/lib/zoomist.js";var w=matchMedia("(pointer: coarse)").matches||!!navigator.maxTouchPoints,j=document.getElementsByTagName("header")[0],U=document.getElementsByTagName("footer")[0];j&&await fetch("/assets/header.html").then(e=>e.text()).then(e=>{j.insertAdjacentHTML("beforeend",e)}).catch(console.error);U&&await fetch("/assets/footer.html").then(e=>e.text()).then(e=>{U.insertAdjacentHTML("beforeend",e)}).catch(console.error);function X(e,t=document.title){let n=document.querySelector("header nav .dropdown");n.getElementsByClassName("text")[0].innerHTML=location.pathname=="/"?"Tools":t,n.querySelectorAll(".content>a").forEach(o=>{if(o.textContent==t){o.classList.add("active");return}}),e&&(document.getElementById("credits").innerHTML=t+" "+e)}document.querySelectorAll(".custom-file-input").forEach(e=>{let t=e.querySelector("input");e.querySelector("button").addEventListener("click",()=>t.click())});var k=new Set;function q(e,t){e.classList.toggle("open",t)?k.add(e):k.delete(e)}window.addEventListener(w?"touchstart":"mousedown",e=>{let t=e.targetTouches?e.changedTouches.item(0).target:e.target;if(t.matches(".dropdown"))q(t);else{if(t.tagName=="A")return;for(let n of k)n.classList.remove("open")}});window.addEventListener("focusin",e=>{if(e.target.matches(".dropdown:not(.open)"))return q(e.target);k.forEach(t=>!t.contains(e.target)&&q(t,!1))});function fe(e){let t="clickTriggered"in e.dataset;e.addEventListener(w?"touchend":t?"click":"mouseenter",pe,!0)}document.querySelectorAll(".tooltip-ref").forEach(fe);var h;function pe(){let e=this,t,n="clickTriggered"in e.dataset,o="allowHover"in e.dataset,s="showAbove"in e.dataset;o&&(t=e.getElementsByClassName("tooltip-space")[0],t&&(t.style.display="block"));let a=e.nextElementSibling;if((w||n)&&a.style.display=="block")return p(a,t);if(a.style.display=="block")return;a.style.display="block";let m=e.getBoundingClientRect(),f=a.getBoundingClientRect(),r=m.left+m.width/2-f.width/2,c=m.top+(s?-f.height-5:m.height+5);r<=0?r=1:r+f.width>window.innerWidth&&(r=window.innerWidth-f.width-4),c>=window.innerHeight?c=window.innerHeight:c+f.height>=window.innerHeight&&(c=window.innerHeight-f.height),a.style.left=r+"px",a.style.top=c+"px",window.addEventListener("scroll",()=>{p(a,t)},{once:!0}),w?(h=l=>{!e.contains(l.target)&&!a.contains(l.target)&&(p(a,t),window.removeEventListener("touchend",h))},window.addEventListener("touchend",h)):(h=l=>{if(e.contains(l.relatedTarget))return e.addEventListener("mouseleave",h,{once:!0});if(l.relatedTarget==t)return t.addEventListener("mouseleave",h,{once:!0});!o||o&&!a.contains(l.relatedTarget)?ye(a)?(a.addEventListener("mouseleave",h,{once:!0}),window.addEventListener("click",L=>{a.contains(L.target)||p(a,t)},{once:!0})):p(a,t):a.addEventListener("mouseleave",h,{once:!0})},e.addEventListener("mouseleave",h,{once:!0}));function p(l,L){w?window.removeEventListener("touchend",h):e.removeEventListener("mouseleave",h),l.style.display="",L&&(L.style.display="")}}function ye(e){let t=window.getSelection();if(t.type!="Range"||t.rangeCount<1)return!1;for(let n=0;n<t.rangeCount;++n)if(!e.contains(t.getRangeAt(n).commonAncestorContainer))return!1;return!0}CSS.supports("selector(:has(*))")||document.querySelectorAll(".radio-chips").forEach(e=>{e.querySelectorAll("input").forEach(t=>{t.checked&&t.parentElement.setAttribute("checked",""),t.addEventListener("change",()=>e.querySelectorAll("label").forEach(n=>n.toggleAttribute("data-chk",n==t.parentElement))),t.addEventListener("focus",()=>t.parentElement.dataset.fcs=""),t.addEventListener("blur",()=>delete t.parentElement.dataset.fcs)})});document.querySelectorAll("[range-link-number]").forEach(e=>{let t=e.nextElementSibling;t.value==""&&(t.value=e.value),e.addEventListener("input",()=>{t.value=e.value,t.dispatchEvent(new Event("change"))}),t.addEventListener("change",()=>e.value=t.value)});globalThis.toolPath=import.meta.url.substring(0,import.meta.url.lastIndexOf("/"));var Ee=`by <a href='https://github.com/Blueyescat' target='_blank'>Blueyescat</a>,
	<br>Inspired by <a href='https://github.com/ivstiv/pixelart-converter' target='_blank'>pixelart-converter</a> by ivstiv.`;Promise.resolve().then(()=>W());X(Ee);var Le=new be({idle:6e4}),C;"OffscreenCanvas"in window?C=new Worker(globalThis.toolPath+"/worker.js"):await import(globalThis.toolPath+"/converter.js");var $=document.querySelector("#main-container"),v=document.getElementById("input-file"),E=document.getElementById("input-width"),b=document.getElementById("input-height"),x=document.getElementById("cb-use-turret-scale"),Se=document.getElementById("cb-paint-id"),Te=document.getElementById("cb-paint-texture"),J=document.getElementById("cb-no-smooth-resizing"),N=document.getElementById("input-coord-x"),M=document.getElementById("input-coord-y"),Q=document.getElementById("input-pixel-size"),ee=document.getElementById("input-font-size"),ke=document.getElementById("select-color-space"),Ie=document.getElementById("button-process"),D=document.getElementById("button-show-resized"),_=document.querySelector("#preview>img"),H=document.querySelector("#preview>.name"),K=document.querySelector("#preview>.size"),Be=document.getElementById("result-container"),y=document.getElementById("result"),Z=document.getElementById("notice"),V=document.getElementById("result-info"),Ce=document.getElementById("result-heading"),g=document.getElementById("result-hover-square"),d=g.querySelector(".coords"),u=document.createElement("canvas"),B=u.getContext("2d",{willReadFrequently:!0}),G,R,F,te,P,z,T,ne,oe,ie,ae,se=1,re=1,O={},i=new Image;window.addEventListener("paste",e=>{let t=e.clipboardData.files?.[0];if(!t||!t.type.includes("image/"))return;let n=new DataTransfer;n.items.add(t),v.files=n.files,v.dispatchEvent(new Event("change"))});window.addEventListener("dragover",e=>{e.preventDefault(),$.style.outline="2px dashed var(--blue)"});window.addEventListener("dragleave",e=>{e.relatedTarget||($.style.outline="")});window.addEventListener("drop",e=>{e.preventDefault(),$.style.outline="",e.dataTransfer.files.length&&(v.files=e.dataTransfer.files,v.dispatchEvent(new Event("change")))});v.addEventListener("change",()=>{let e=v.files?.[0];if(!e){T=!1,v.style.backgroundImage=null;return}if(!e.type.includes("image/"))return v.value=null;Re(URL.createObjectURL(e),e.name)});async function Re(e,t){if(i.src=e,!await new Promise(o=>{i.onerror=()=>o(!1),i.onload=()=>o(!0)})){_.src="",H.textContent="ERROR - Unable to use this image.",K.textContent="",T=!1;return}P=void 0,z=void 0,T=!0,O={},_.src=e,t.length>55?H.textContent=t.substr(0,40)+"..."+t.substr(t.length-10,t.length):H.textContent=t,K.textContent=`(${i.width}x${i.height})`,ce(x.checked)}x.addEventListener("change",()=>{P||z||!T||ce(x.checked)});function ce(e){i.width==i.height&&i.width>78?E.value=b.value=e?78/3:78:(i.width<=78&&(E.value=e?(i.width/3).toFixed(1):i.width),i.height<=78&&(b.value=e?(i.height/3).toFixed(1):i.height))}E.addEventListener("input",function(){if(!z){let e=de(i.width,i.height,parseFloat(this.value),i.height).height;if(isNaN(e))return;b.value=x.checked?le(e):Math.round(e)}P=!0});b.addEventListener("input",function(){if(!P){let e=de(i.width,i.height,i.width,parseFloat(this.value)).width;if(isNaN(e))return;E.value=x.checked?le(e):Math.round(e)}z=!0});N.addEventListener("input",()=>se=parseInt(N.value));M.addEventListener("input",()=>re=parseInt(M.value));Ie.addEventListener("click",async()=>{if(!T)return S("You haven't chosen an image.");let e=x.checked?Math.round(parseFloat(E.value)*3):parseInt(E.value);if(!e||e<1)return S("The entered width is invalid.");let t=x.checked?Math.round(parseFloat(b.value)*3):parseInt(b.value);if(!t||t<1)return S("The entered height is invalid.");let n=parseInt(Q.value);if(!n||n<1)return S("The entered pixel size is invalid.");let o=parseInt(ee.value);if(isNaN(o))return S("The entered font size is invalid.");S(),u.width=e,u.height=t,V.textContent="...";let s=performance.now(),a=""+J.checked+e+t,m=O[a];!m&&i.width==e&&i.height==t?(B.drawImage(i,0,0,u.width,u.height),D.style.display="none"):(m?(i.src=URL.createObjectURL(m),i.complete||await new Promise(c=>i.onload=()=>c()),B.drawImage(i,0,0,u.width,u.height)):(await Le.resize(i,u,J.checked?{filter:"box"}:void 0),u.toBlob(c=>O[a]=te=c)),D.style.display="");let r=(await Pe({colorSpace:ke.value,imageData:B.getImageData(0,0,u.width,u.height),pixelSize:n,fontSize:o,drawPaintTexture:Te.checked,drawPaintId:Se.checked})).imageData;ne=n,ae=t,V.textContent=`${e}x${t}sq - ${r.width}x${r.height}px - ${Math.round(performance.now()-s)}ms`,u.width=oe=r.width,u.height=ie=r.height,B.putImageData(r,0,0),y.src=URL.createObjectURL(await new Promise(c=>u.toBlob(c))),g.style.display="none",R?.destroy(),y.complete||await new Promise(c=>y.addEventListener("load",c)),R=new xe(".zoomist-container",{bounds:!1,zoomRatio:.3,initScale:1,minScale:.03,maxScale:100,on:{zoom(){g.style.display="none"},dragStart(){g.style.display="none"},drag(){F=!0},dragEnd(){setTimeout(()=>F=!1,0)},ready(){setTimeout(()=>Ce.scrollIntoView({behavior:"smooth"}),100),y.style.pointerEvents="auto",y.draggable=!1}}})});async function Pe(e){let t;return C?(C.postMessage(e),t=await new Promise(n=>C.addEventListener("message",o=>n(o.data.imageData),{once:!0}))):t=await globalThis.img2pixar(null,e),t}y.addEventListener(w?"touchend":"click",e=>{let t=e.changedTouches?.item(0)??e;if(F)return;let n=t.clientX,o=t.clientY,s=y.getBoundingClientRect(),a=n-s.left,m=o-s.top,f=Math.min(y.width/oe,y.height/ie),r=ne*R.transform.scale*f,c=Math.floor(a/r),p=Math.floor(m/r);if(c<0||p<0)return g.style.display="none";let l=Be.getBoundingClientRect(),L=s.left-l.left+(c??1)*r,ue=s.top-l.top+(p??1)*r,he=se+c,ge=ae-(-re+1+p);g.style.display="",g.style.width=g.style.height=r+"px",g.style.left=L+"px",g.style.top=ue+"px",d.textContent=he+","+ge;let A=g.getBoundingClientRect();A.bottom+20>=l.bottom?(d.style.top="-20px",d.style.bottom="unset"):(d.style.top="unset",d.style.bottom="-20px"),A.left-30<=l.left?(d.style.left="0",d.style.right="unset",d.style.transform="unset"):A.right+30>=l.right?(d.style.left="unset",d.style.right="0",d.style.transform="unset"):(d.style.left="50%",d.style.right="unset",d.style.transform="translateX(-50%)")});(async function(){let e="";navigator.keyboard?await navigator.keyboard.getLayoutMap().then(t=>{e+=`(The debug key should be <b>${t.get("Slash")}</b> for your locale)`}):e+="(The debug key is slash <b>/</b>, might be something else depending on your locale, like period <b>.</b>)",document.getElementById("debug-key-info").insertAdjacentHTML("beforeend",e)})();document.getElementById("button-reset-zoom").addEventListener("click",()=>R?.reset());D.addEventListener("click",()=>window.open(URL.createObjectURL(te),"_blank"));for(let e of[E,b,ee,Q,N,M])e.addEventListener("focus",()=>e.select());function le(e){let t=Math.trunc(e),n=e-t;return n==0?t:n<=1/3?t+.3:n<=1/3*2?t+.6:t+1}function de(e,t,n,o){let s=Math.min(n/e,o/t);return{width:e*s,height:t*s}}function S(e=""){clearTimeout(G),Z.textContent=e,e!=""&&(G=setTimeout(()=>Z.textContent="",8e3))}
//# sourceMappingURL=main.js.map
