var m={},x;fetch(globalThis.toolPath+"/assets/color-palettes.json").then(t=>t.json()).then(t=>x=t).catch(console.error);globalThis.img2pixar=async function(t,a){if(!t){if(!document)return;t=document.createElement("canvas")}let e=t.getContext("2d",{willReadFrequently:!0}),n=a.imageData.data,o=a.pixelSize,i=a.imageData.width,r=a.imageData.height,s;t.width=i*o,t.height=r*o,a.drawPaintId&&(e.font=`${a.fontSize}px Verdana, Geneva, Tahoma, sans-serif`),a.drawPaintTexture&&(s=await O(globalThis.toolPath+"/assets/bg_ship.png"));let c=0,l=0;for(let h=0;h<n.length;h+=4){h!=0&&h/4%i==0&&(l+=o,c=0);let d=j(a.colorSpace,[n[h],n[h+1],n[h+2]]),p=x.RGB[d],f=`rgb(${p[0]}, ${p[1]}, ${p[2]})`;s?(e.drawImage(s,c,l,o,o),e.fillStyle=f,e.globalCompositeOperation="multiply",e.fillRect(c,l,o,o),e.globalCompositeOperation="source-over"):(e.fillStyle=f,e.fillRect(c,l,o,o)),a.drawPaintId&&(e.fillStyle=b(p)?"white":"black",e.fillText(d,c,l+o-2,o)),c+=o}return{imageData:e.getImageData(0,0,t.width,t.height)}};async function O(t){return createImageBitmap(await(await fetch(t).catch(console.error)).blob())}function b(t,a=128){return .2126*t[0]+.7152*t[1]+.0722*t[2]<a}function j(t,a){let e,n;t=="CIE2000"?(e="LAB",n=B,a=G($(a))):(e="RGB",n=R);let o,i,r=a.join("");if(Object.hasOwn(m,e)||(m[e]={}),Object.hasOwn(m[e],r))o=m[e][r];else{let s=-1;for(let c in x[e]){let l=x[e][c],h=n(a,l);(s==-1||h<s)&&(s=h,o=c,i=c)}m[e][r]=i}return o}function R(t,a){return Math.sqrt(Math.pow(t[0]-a[0],2)+Math.pow(t[1]-a[1],2)+Math.pow(t[2]-a[2],2))}function B(t,a){let e=I=>360*I/(2*Math.PI),n=I=>2*Math.PI*I/360,o=(t[0]+a[0])/2,i=Math.sqrt(Math.pow(t[1],2)+Math.pow(t[2],2)),r=Math.sqrt(Math.pow(a[1],2)+Math.pow(a[2],2)),s=(i+r)/2,c=(1-Math.sqrt(Math.pow(s,7)/(Math.pow(s,7)+Math.pow(25,7))))/2,l=t[1]*(1+c),h=a[1]*(1+c),d=Math.sqrt(Math.pow(l,2)+Math.pow(t[2],2)),p=Math.sqrt(Math.pow(h,2)+Math.pow(a[2],2)),f=(d+p)/2,M=e(Math.atan2(t[2],l));M<0&&(M=M+360);let w=e(Math.atan2(a[2],h));w<0&&(w=w+360);let u=Math.abs(M-w)>180?(M+w+360)/2:(M+w)/2,D=1-.17*Math.cos(n(u-30))+.24*Math.cos(n(2*u))+.32*Math.cos(n(3*u+6))-.2*Math.cos(n(4*u-63)),g=w-M;Math.abs(g)>180&&(w<=M?g+=360:g-=360);let P=a[0]-t[0],y=p-d;g=2*Math.sqrt(d*p)*Math.sin(n(g)/2);let T=1+.015*Math.pow(o-50,2)/Math.sqrt(20+Math.pow(o-50,2)),C=1+.045*f,q=1+.015*f*D,z=30*Math.exp(-Math.pow((u-275)/25,2)),S=-(2*Math.sqrt(Math.pow(f,7)/(Math.pow(f,7)+Math.pow(25,7))))*Math.sin(2*n(z));return Math.sqrt(Math.pow(P/(1*T),2)+Math.pow(y/(1*C),2)+Math.pow(g/(1*q),2)+S*(y/(1*C))*(g/(1*q)))}function $(t){let[a,e,n]=[...t].map(s=>(s/=255,(s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)*100)),o=.4124*a+.3576*e+.1805*n,i=.2126*a+.7152*e+.0722*n,r=.0193*a+.1192*e+.9505*n;return[o,i,r]}var E=[94.811,100,107.304];function G(t){let[a,e,n]=[...t].map((s,c)=>(s/=E[c],s>.008856?Math.pow(s,.3333333333333333):7.787*s+.13793103448275862)),o=116*e-16,i=500*(a-e),r=200*(e-n);return[o,i,r]}
//# sourceMappingURL=converter.js.map
