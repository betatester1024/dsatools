var se=(e,n)=>()=>(e&&(n=e(e=0)),n);var fe={};function Y(){let e=localStorage.getItem(H);if(e){try{e=JSON.parse(e)}catch{}for(let t in e){let a=document.querySelector(t+(t.includes('type="radio"')?`[value="${e[t]}"]`:""));if(!a){delete e[t];continue}a.type=="checkbox"||a.type=="radio"?a.checked=!!e[t]:a.value=e[t],a.dispatchEvent(new Event(a.tagName=="TEXTAREA"?"input":"change"))}localStorage.setItem(H,JSON.stringify(e))}document.querySelectorAll("[data-save]").forEach(t=>{t.addEventListener(t.tagName=="TEXTAREA"?"input":"change",()=>{let a=ue(t),s=localStorage.getItem(H)??"{}";try{s=JSON.parse(s)}catch{s={}}s[a]=t.value,t.type=="checkbox"?s[a]=t.checked:s[a]=t.value,localStorage.setItem(H,JSON.stringify(s))})})}function ue(e){let n=[];for(;e&&e.tagName!="BODY";){let t;if(e.id!=""){t="#"+e.id,n.unshift(t);break}else if(e.type=="radio"&&e.name){t=`#${e.dataset.save} ${e.tagName.toLowerCase()}[type="${e.type}"][name="${e.name}"]`,n.unshift(t);break}else t=`:nth-child(${Array.from(e.parentNode.children).indexOf(e)+1})`,n.unshift(t);e=e.parentNode}return n.join(">")}var H,z=se(()=>{H="dsatools_inputs-"+globalThis.toolPath.split("/").pop();document.readyState!="loading"?Y():document.addEventListener("DOMContentLoaded",Y)});import{BuildCmd as pe,Item as W,PREFIX as ge,decode as _e,encode as Ae}from"/lib/dsabp-js.js";import{BuildBits as S,BuildCmd as R,ConfigCmd as M,Item as E,LoaderPoint as _,Shape as o}from"/lib/dsabp-js.js";var T={H:new Map([[o.RAMP_DL,o.RAMP_DR],[o.RAMP_UL,o.RAMP_UR],[o.SLAB_L,o.SLAB_R],[o.HALF_RAMP_1_D,o.HALF_RAMP_1_DI],[o.HALF_RAMP_1_L,o.HALF_RAMP_1_RI],[o.HALF_RAMP_2_D,o.HALF_RAMP_2_DI],[o.HALF_RAMP_2_L,o.HALF_RAMP_2_RI],[o.HALF_RAMP_1_UI,o.HALF_RAMP_1_U],[o.HALF_RAMP_1_LI,o.HALF_RAMP_1_R],[o.HALF_RAMP_2_UI,o.HALF_RAMP_2_U],[o.HALF_RAMP_2_LI,o.HALF_RAMP_2_R],[o.HALF_RAMP_3_D,o.HALF_RAMP_3_DI],[o.HALF_RAMP_3_L,o.HALF_RAMP_3_RI],[o.HALF_RAMP_3_UI,o.HALF_RAMP_3_U],[o.HALF_RAMP_3_LI,o.HALF_RAMP_3_R],[o.QUARTER_DL,o.QUARTER_DR],[o.QUARTER_UL,o.QUARTER_UR],[o.QUARTER_RAMP_DL,o.QUARTER_RAMP_DR],[o.QUARTER_RAMP_UL,o.QUARTER_RAMP_UR],[o.BEVEL_DL,o.BEVEL_DR],[o.BEVEL_UL,o.BEVEL_UR]]),V:new Map([[o.RAMP_UR,o.RAMP_DR],[o.RAMP_UL,o.RAMP_DL],[o.SLAB_U,o.SLAB_D],[o.HALF_RAMP_1_R,o.HALF_RAMP_1_RI],[o.HALF_RAMP_2_R,o.HALF_RAMP_2_RI],[o.HALF_RAMP_1_UI,o.HALF_RAMP_1_D],[o.HALF_RAMP_1_DI,o.HALF_RAMP_1_U],[o.HALF_RAMP_1_LI,o.HALF_RAMP_1_L],[o.HALF_RAMP_2_UI,o.HALF_RAMP_2_D],[o.HALF_RAMP_2_DI,o.HALF_RAMP_2_U],[o.HALF_RAMP_2_LI,o.HALF_RAMP_2_L],[o.HALF_RAMP_3_R,o.HALF_RAMP_3_RI],[o.HALF_RAMP_3_L,o.HALF_RAMP_3_LI],[o.HALF_RAMP_3_UI,o.HALF_RAMP_3_D],[o.HALF_RAMP_3_DI,o.HALF_RAMP_3_U],[o.QUARTER_UR,o.QUARTER_DR],[o.QUARTER_UL,o.QUARTER_DL],[o.QUARTER_RAMP_DR,o.QUARTER_RAMP_UR],[o.QUARTER_RAMP_UL,o.QUARTER_RAMP_DL],[o.BEVEL_DR,o.BEVEL_UR],[o.BEVEL_UL,o.BEVEL_DL]])},b={H:new Map([[_.TOP_LEFT,_.TOP_RIGHT],[_.LEFT,_.RIGHT],[_.BOTTOM_LEFT,_.BOTTOM_RIGHT]]),V:new Map([[_.TOP_LEFT,_.BOTTOM_LEFT],[_.TOP,_.BOTTOM],[_.TOP_RIGHT,_.BOTTOM_RIGHT]])};for(let e of["H","V"]){for(let[n,t]of T[e])T[e].set(t,n);for(let[n,t]of b[e])b[e].set(t,n)}function D(e,n){for(let t of e.commands)t instanceof M?(t.loader?.pickupPoint!=null&&(t.loader.pickupPoint=b[n].get(t.loader.pickupPoint)??t.loader.pickupPoint),t.loader?.dropPoint!=null&&(t.loader.dropPoint=b[n].get(t.loader.dropPoint)??t.loader.dropPoint),t.pusher?.angle!=null&&(t.pusher.angle=(n=="H"?180:360)-t.pusher?.angle,t.pusher.angle<0&&(t.pusher.angle+=360)),t.angle!=null&&(t.angle=(n=="H"?180:360)-t.angle,t.angle<0&&(t.angle+=360))):t instanceof R&&(t.shape&&(t.shape=T[n].get(t.shape)??t.shape),n=="H"?(t.bits&&(t.bits=new S(t.bits.toString().split("").reduce((a,s)=>s+a)),t.x+=t.bits.size-1),t.x=e.width-t.x-1):n=="V"&&(t.y=e.height-t.y-1))}function O(e,n){let t={x:n.left,y:n.bottom},a={x:e.width-n.right-1,y:e.height-n.top-1};e.commands=e.commands.filter(c=>{if(c instanceof M)return!0;if(c instanceof R){if(c.bits&&!c.bits.isOne()){let r;for(let[d,u]of c.bits.toArray().entries())if(u==!0){if(!s(c.x+d,c.y)){r==null&&(r=c.x+d);continue}if(c.bits.clear(d),c.bits.isZero())return!1}c.x=r,c.bits.trimLeadZeros()}return s(c.x,c.y)?!1:(n.delete&&(c.x-=n.left,c.y-=n.bottom),!0)}}),n.delete&&(e.width-=n.right+n.left,e.height-=n.top+n.bottom),X(e);function s(c,r){let d=c>=t.x&&c<=a.x&&r>=t.y&&r<=a.y;return n.delete?!d:d}}function N(e,n){let t=e.width/2,a=e.height/2;n*=Math.PI/180;let s=Math.cos(n),c=Math.sin(n),r=1/0,d=1/0,u=0,f=0;V(e);for(let i of e.commands)i instanceof R&&([i.x,i.y]=h(i.x,i.y),r=Math.min(r,i.x),d=Math.min(d,i.y),u=Math.max(u,i.x),f=Math.max(f,i.y));for(let i of e.commands)i instanceof R&&(i.x=i.x-r,i.y=i.y-d);e.width=Math.ceil(u-r+1),e.height=Math.ceil(f-d+1),Q(e);function h(i,l){return[U((i-t)*s-(l-a)*c+t),U((i-t)*c+(l-a)*s+a)]}}function U(e,n=10){let t=10**n;return Math.round(e*t)/t}function $(e,n){let{search:t,replacement:a}=n,s=a=="",c=0,r=new Set(ae(t)),d=r.has(E.NULL),u=s?E.NULL:isNaN(a)?q(a)[0]:E.getById(parseInt(a));if(u==null)return c;let f=new Set,h=e.commands.length;for(;h--;){let i=e.commands[h];if(i instanceof R){if(d)if(i.bits){let l=0;for(let p of i.bits)p&&f.add(`${i.x+l},${i.y}`),++l}else f.add(`${i.x},${i.y}`);r.has(i.item)&&(s?e.commands.splice(h,1):(i.item=u,u.isBuildable||(i.shape=void 0)),c+=i.bits?i.bits.toArray().filter(l=>l).length:1)}}if(X(e),d){V(e);for(let i=0;i<e.width;i++)for(let l=0;l<e.height;l++)f.has(`${i},${l}`)||(e.commands.push(new R({x:i,y:l,item:u})),++c);Q(e)}return c}function ae(e){let n=[],t=new Set;for(let s of new Set(e))s=="block"?t.add("block"):s=="buildable"?t.add("buildable"):s=="non-buildable"||s=="nonbuildable"?t.add("nonbuildable"):s=="machine"?t.add("mac"):s=="big machine"?t.add("bigmac"):s=="1x1 machine"||s=="small machine"?t.add("smallmac"):s=="hull mounted"||s=="hull-mounted"||s=="hull"?t.add("hull"):isNaN(s)?n.push(...q(s)):n.push(E.getById(parseInt(s)));let a=s=>s.buildInfo?.[0]?.bounds.x>1||s.buildInfo?.[0]?.bounds.y>1;if(t.size)for(let s of E.getMap().values())(t.has("block")&&s.isBlock||t.has("buildable")&&s.isBuildable||t.has("nonbuildable")&&!s.isBuildable||t.has("mac")&&s.isBuildable&&!s.isBlock||t.has("bigmac")&&s.isBuildable&&!s.isBlock&&a(s)||t.has("smallmac")&&s.isBuildable&&!s.isBlock&&!a(s)||t.has("hull")&&s.isBuildable&&s.buildInfo?.[0]?.require_blocks?.[0].block.includes("HULL"))&&n.push(s);return n}function q(e){if(e=="air")return[E.NULL];let n=[];for(let t of E.getMap().values())t.name.toLowerCase().includes(e)&&n.push(t);return n}function Q(e){class n{cfgCmd;commands;constructor(l,p){this.commands=[l],this.cfgCmd=p}get item(){return this.commands[0]?.item}get shape(){return this.commands[0]?.shape}}let t={},a;for(let i of e.commands)if(i instanceof M)a=i;else if(i instanceof R){t[i.y]||(t[i.y]=[]);let l=f(i);l?l.commands.push(i):t[i.y].push(new n(i,a?.clone()))}e.commands.length=0;let s=[],c,r,d=0,u=Object.values(t);for(let i=u.length-1;i>=0;i--)for(let l of u[i]){let p=l.item==E.EXPANDO_BOX;if(r=(p?s:e.commands).length,l.cfgCmd&&!l.cfgCmd.equals(c)){let A=h(l.cfgCmd,p);A>-1?r=A:(c=l.cfgCmd,p?s.push(l.cfgCmd):e.commands.push(l.cfgCmd))}l.commands.sort((A,y)=>A.x-y.x);let g=[[]];for(let A of l.commands)A.x-g[g.length-1]?.[0]?.x>=63&&g.push([]),g[g.length-1].push(A);for(let A of g){let y=A.shift();if(A.length){y.bits=new S("1");for(let ie of A)y.bits.set(Math.floor(ie.x-y.x))}(p?s:e.commands).splice(y.item.isBlock?d++:r+1,0,y)}}e.commands.push(...s);function f(i){for(let l of t[i.y])if((Math.abs(l.commands[0].x%1-i.x%1)/l.commands[0].x||0)==0&&l.item==i.item&&l.shape==i.shape&&(!(l.cfgCmd&&a)||l.cfgCmd.equals(a)))return l}function h(i,l){let p=l?s:e.commands;for(let g=p.length-1;g>=0;g--)if(p[g]instanceof M&&p[g].equals(i))return g;return-1}}function V(e){let n=e.commands.length;for(;n--;){let t=e.commands[n];if(!(t instanceof R&&t.bits&&!t.bits.isOne()))continue;e.commands.splice(n,1);let a=0,s=0;for(let c of t.bits){if(c){let r=new R({x:t.x+s,y:t.y,item:t.item,shape:t.shape});e.commands.splice(n+a,0,r),++a}++s}}}function X(e){let n=e.commands,t=n.length;for(;t--;)n[t]instanceof M&&(n[t-1]instanceof M&&n.splice(t-1,1),t==n.length-1&&n.splice(t,1))}var I=matchMedia("(pointer: coarse)").matches||!!navigator.maxTouchPoints,j=document.getElementsByTagName("header")[0],G=document.getElementsByTagName("footer")[0];j&&await fetch("/assets/header.html").then(e=>e.text()).then(e=>{j.insertAdjacentHTML("beforeend",e)}).catch(console.error);G&&await fetch("/assets/footer.html").then(e=>e.text()).then(e=>{G.insertAdjacentHTML("beforeend",e)}).catch(console.error);function J(e,n=document.title){let t=document.querySelector("header nav .dropdown");t.getElementsByClassName("text")[0].innerHTML=location.pathname=="/"?"Tools":n,t.querySelectorAll(".content>a").forEach(a=>{if(a.textContent==n){a.classList.add("active");return}}),e&&(document.getElementById("credits").innerHTML=n+" "+e)}document.querySelectorAll(".custom-file-input").forEach(e=>{let n=e.querySelector("input");e.querySelector("button").addEventListener("click",()=>n.click())});var B=new Set;function F(e,n){e.classList.toggle("open",n)?B.add(e):B.delete(e)}window.addEventListener(I?"touchstart":"mousedown",e=>{let n=e.targetTouches?e.changedTouches.item(0).target:e.target;if(n.matches(".dropdown"))F(n);else{if(n.tagName=="A")return;for(let t of B)t.classList.remove("open")}});window.addEventListener("focusin",e=>{if(e.target.matches(".dropdown:not(.open)"))return F(e.target);B.forEach(n=>!n.contains(e.target)&&F(n,!1))});function le(e){let n="clickTriggered"in e.dataset;e.addEventListener(I?"touchend":n?"click":"mouseenter",re,!0)}document.querySelectorAll(".tooltip-ref").forEach(le);var L;function re(){let e=this,n,t="clickTriggered"in e.dataset,a="allowHover"in e.dataset,s="showAbove"in e.dataset;a&&(n=e.getElementsByClassName("tooltip-space")[0],n&&(n.style.display="block"));let c=e.nextElementSibling;if((I||t)&&c.style.display=="block")return h(c,n);if(c.style.display=="block")return;c.style.display="block";let r=e.getBoundingClientRect(),d=c.getBoundingClientRect(),u=r.left+r.width/2-d.width/2,f=r.top+(s?-d.height-5:r.height+5);u<=0?u=1:u+d.width>window.innerWidth&&(u=window.innerWidth-d.width-4),f>=window.innerHeight?f=window.innerHeight:f+d.height>=window.innerHeight&&(f=window.innerHeight-d.height),c.style.left=u+"px",c.style.top=f+"px",window.addEventListener("scroll",()=>{h(c,n)},{once:!0}),I?(L=i=>{!e.contains(i.target)&&!c.contains(i.target)&&(h(c,n),window.removeEventListener("touchend",L))},window.addEventListener("touchend",L)):(L=i=>{if(e.contains(i.relatedTarget))return e.addEventListener("mouseleave",L,{once:!0});if(i.relatedTarget==n)return n.addEventListener("mouseleave",L,{once:!0});!a||a&&!c.contains(i.relatedTarget)?de(c)?(c.addEventListener("mouseleave",L,{once:!0}),window.addEventListener("click",l=>{c.contains(l.target)||h(c,n)},{once:!0})):h(c,n):c.addEventListener("mouseleave",L,{once:!0})},e.addEventListener("mouseleave",L,{once:!0}));function h(i,l){I?window.removeEventListener("touchend",L):e.removeEventListener("mouseleave",L),i.style.display="",l&&(l.style.display="")}}function de(e){let n=window.getSelection();if(n.type!="Range"||n.rangeCount<1)return!1;for(let t=0;t<n.rangeCount;++t)if(!e.contains(n.getRangeAt(t).commonAncestorContainer))return!1;return!0}CSS.supports("selector(:has(*))")||document.querySelectorAll(".radio-chips").forEach(e=>{e.querySelectorAll("input").forEach(n=>{n.checked&&n.parentElement.setAttribute("checked",""),n.addEventListener("change",()=>e.querySelectorAll("label").forEach(t=>t.toggleAttribute("data-chk",t==n.parentElement))),n.addEventListener("focus",()=>n.parentElement.dataset.fcs=""),n.addEventListener("blur",()=>delete n.parentElement.dataset.fcs)})});document.querySelectorAll("[range-link-number]").forEach(e=>{let n=e.nextElementSibling;n.value==""&&(n.value=e.value),e.addEventListener("input",()=>{n.value=e.value,n.dispatchEvent(new Event("change"))}),n.addEventListener("change",()=>e.value=n.value)});globalThis.toolPath=import.meta.url.substring(0,import.meta.url.lastIndexOf("/"));var me=`by <a href='https://github.com/Blueyescat' target='_blank'>Blueyescat</a>.
	Uses <a href='https://github.com/Blueyescat/dsabp-js' target='_blank'>dsabp-js</a>.`,he=Promise.resolve().then(()=>(z(),fe));J(me);var C=document.getElementById("bp-input"),ee=Array.from(document.getElementById("chips-operation").querySelectorAll("input")),Le=document.getElementById("op-options"),m=document.getElementById("result"),Re={input:document.getElementById("notice-input"),result:document.getElementById("notice-result"),copy:document.getElementById("notice-copy")},Ee=document.getElementById("button-process"),te=document.getElementById("button-copy"),ye=document.getElementById("button-move"),k=document.getElementById("input-rotate-angle"),Z={},x=new URLSearchParams(window.location.search),P,v="0",K,ne;C.addEventListener("input",function(){this.style.height=0,this.style.height=this.scrollHeight+2+"px",clearTimeout(K),K=setTimeout(()=>ve(this.value.trim()),300)});if(x.has("op")){let e=ee.find(n=>n.value==x.get("op"));he.then(()=>{e&&!e.checked&&(e.checked=!0,e.dispatchEvent(new Event("change")))})}ee.forEach(e=>{e.addEventListener("change",function(){v=this.value,Le.querySelectorAll(":scope > div").forEach(t=>t.classList.toggle("active",t.dataset.op==v)),x.set("op",v),history.replaceState(null,null,"?"+x.toString())})});async function ve(e){if(e=="")return w("input","suc","");P=await _e(e).catch(n=>{w("input","err","Invalid blueprint string."),console.info("Blueprint decoding error:",n.message)}),P&&w("input","suc",oe(e,P))}Ee.addEventListener("click",async()=>{if(P==null)return;let e=P.clone(),n;v=="crop"?O(e,{delete:document.getElementById("select-crop-mode").value=="0",top:parseInt(document.getElementById("input-crop-top").value),right:parseInt(document.getElementById("input-crop-right").value),bottom:parseInt(document.getElementById("input-crop-bottom").value),left:parseInt(document.getElementById("input-crop-left").value)}):v=="flip"?D(e,document.getElementById("select-flip-direction").value):v=="rotate"?N(e,parseFloat(k.value)):v=="replace"&&(n=`Replaced ${$(e,{search:document.getElementById("input-replace-search").value.toLowerCase().trim().replace(/ +/," ").split(/\s*,\s*/),replacement:document.getElementById("input-replace-replacement").value.toLowerCase().trim().replace(/ +/," ")})} items`),m.textContent=ge+await Ae(e),ne&&te.click(),m.focus(),m.style.height=0,m.style.height=m.scrollHeight+"px",m.scrollTop=m.scrollHeight,w("result","suc",(n?`${n}
`:"")+oe(m.textContent,e))});document.getElementById("cb-auto-copy").addEventListener("change",e=>ne=e.target.checked);document.getElementById("rotate-angle-buttons").addEventListener("click",e=>{"a"in e.target.dataset&&(k.value=e.target.dataset.a,k.dispatchEvent(new Event("change")))});(function(){let e=document.getElementById("replace-item-list"),n=[],t=[];for(let a of W.getMap().values())a!=W.NULL&&(a.isBuildable?n:t).push(`${a.id.toString().padStart(3,"0")}: ${a.name}`);e.innerHTML+=n.join("<br>")+"<br><br>"+t.join("<br>")})();m.addEventListener("focus",()=>m.select());m.addEventListener("dblclick",()=>m.select());te.addEventListener("click",()=>{navigator.clipboard.writeText(m.textContent).catch(console.error),w("copy","var(--blue)","Copied!",2e3)});ye.addEventListener("click",()=>{C.value=m.textContent,C.dispatchEvent(new Event("input")),m.textContent="",w("result","suc","")});function oe(e,n){let t=n.commands.filter(a=>a instanceof pe).length;return`${e.length} characters, ${n.width}x${n.height}, ${t} build commands, ${n.commands.length-t} config commands`}function w(e,n,t="",a){let s=Re[e];clearTimeout(Z[e]),s.style.color=n=="err"?"#D8000C":n=="suc"?"#61C761":n,s.textContent=t,t!=""&&a&&(Z[e]=setTimeout(()=>s.textContent="",typeof a=="number"?a:8e3))}
//# sourceMappingURL=main.js.map
